# PHP mode on Emacs

This guide walks through installing and configuring Emacs with `php-mode`, `flycheck`, and `company` on a remote server accessed via SSH. Assumes a Unix-like system (e.g., Linux) and basic Emacs installed.

**Date:** April 4, 2025

---

## Step 1: Connect to the Server
Log in via SSH:
```bash
ssh username@server-address
```

---

## Step 2: Install Emacs
Check if Emacs is installed:
```bash
emacs --version
```
If not, install it:
- Debian/Ubuntu: `sudo apt update && sudo apt install emacs`
- Red Hat/CentOS: `sudo yum install emacs`

---

## Step 3: Set Up MELPA Package Repository
Edit `~/.emacs` (create it if it doesn’t exist):
```bash
emacs ~/.emacs
```
Add these lines to enable MELPA:
```elisp
(require 'package)
(add-to-list 'package-archives '("melpa" . "https://melpa.org/packages/") t)
(package-initialize)
```
Save and exit (`C-x C-s`, then `C-x C-c`).

---

## Step 4: Import MELPA GPG Key
MELPA signs its packages, so you need the public key:
1. Install GPG if missing:
   - Debian/Ubuntu: `sudo apt install gnupg`
   - Red Hat/CentOS: `sudo yum install gnupg`
2. Import the key (use the latest key ID from errors, e.g., `645357D2883A0966`):
   ```bash
   gpg --keyserver hkps://keyserver.ubuntu.com --recv-keys 645357D2883A0966
   ```
   - If `keys.openpgp.org` works, use it: `gpg --keyserver hkps://keys.openpgp.org --recv-keys 645357D2883A0966`
   - If keyservers fail, manually fetch the key from a local machine, export it (`gpg --export -a 645357D2883A0966 > melpa-key.asc`), transfer it (`scp`), and import (`gpg --import melpa-key.asc`).

---

## Step 5: Refresh Package List
In Emacs, update the package list:
```
M-x package-refresh-contents
```
If you get a "No public key" error, revisit Step 4. If network issues persist, disable signature checks (less secure):
```elisp
(setq package-check-signature nil)
```

---

## Step 6: Install PHP Mode
Install `php-mode`:
```
M-x package-install RET php-mode RET
```
Configure it in `~/.emacs`:
```elisp
(require 'php-mode)
(add-to-list 'auto-mode-alist '("\\.php\\'" . php-mode))
```

---

## Step 7: Test PHP Mode
Open a PHP file:
```bash
emacs test.php
```
Add some code:
```php
<?php
echo "Hello, world!";
?>
```
Check for syntax highlighting and indentation (`TAB`).

---

## Step 8: Optional Enhancements
### Syntax Checking with Flycheck
Install `flycheck`:
```
M-x package-install RET flycheck RET
```
Add to `~/.emacs`:
```elisp
(global-flycheck-mode)
```
Ensure PHP is installed (`php -v`), or install it (e.g., `sudo apt install php`).

### Autocompletion with Company
Install `company`:
```
M-x package-install RET company RET
```
Add to `~/.emacs`:
```elisp
(global-company-mode)
```

---

## Final `~/.emacs` Example
Your `~/.emacs` might look like this:
```elisp
(require 'package)
(add-to-list 'package-archives '("melpa" . "https://melpa.org/packages/") t)
(package-initialize)

;; PHP mode setup
(require 'php-mode)
(add-to-list 'auto-mode-alist '("\\.php\\'" . php-mode))

;; Syntax checker
(global-flycheck-mode)

;; Autocomplete
(global-company-mode)

;; Auto-generated by Emacs
(custom-set-variables
 '(package-selected-packages '(company flycheck php-mode)))
(custom-set-faces)
```

---

## Troubleshooting
- **Keyserver Fails**: Try alternative servers (`hkps://pgp.mit.edu`) or manual import.
- **No Syntax Checking**: Verify `php` is in PATH.
- **Permissions**: If you can’t write to `/usr`, install packages locally in `~/.emacs.d/`.

---

## Usage
Copy this file to your server (e.g., `scp emacs-php-setup.md username@server-address:~/`), then follow the steps. Enjoy coding PHP in Emacs!
